
	SUBROUTINE FSIM2(A,B,FS,F,EPS,S)
	EXTERNAL FS,F
	DOUBLE PRECISION A,B,F,S,H,S1,S2,TS1,TS2,X,G,S0,C
	N=1
	H=0.5*(B-A)
	C=(B-A)*1.0E-06
	CALL SIMP1(A,FS,F,EPS,S1)
	CALL SIMP1(B,FS,F,EPS,S2)
	TS1=H*(S1+S2)
10	X=A-H
	TS2=0.5*TS1
	DO 20 J=1,N
	  X=X+2*H
	  CALL SIMP1(X,FS,F,EPS,G)
	  TS2=TS2+H*G
20	CONTINUE
	S=(4*TS2-TS1)/3.0
	N=N+N
	IF (N.GE.16) THEN
	  IF (ABS(S-S0).LE.EPS*(ABS(S)+1.0)) RETURN
	END IF
	S0=S
	TS1=TS2
	H=0.5*H
	IF (ABS(H).GE.ABS(C)) GOTO 10
	RETURN
	END

	SUBROUTINE SIMP1(X,FS,F,EPS,G)
	DOUBLE PRECISION X,F,G,Y1,Y2,H,C,TS1,TS2,Y,G0
	N=1
	CALL FS(X,Y1,Y2)
	H=0.5*(Y2-Y1)
	C=(Y2-Y1)*1.0E-06
	TS1=H*(F(X,Y1)+F(X,Y2))
10	Y=Y1-H
	TS2=0.5*TS1
	DO 20 I=1,N
	  Y=Y+2*H
	  TS2=TS2+H*F(X,Y)
20	CONTINUE
	G=(4*TS2-TS1)/3.0
	N=N+N
	IF (N.GE.16) THEN
	  IF (ABS(G-G0).LE.EPS*(ABS(G)+1.0)) RETURN
	END IF
	G0=G
	TS1=TS2
	H=0.5*H
	IF (ABS(H).GE.ABS(C)) GOTO 10
	RETURN
	END

